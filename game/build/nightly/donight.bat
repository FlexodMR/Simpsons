@echo on
:// ============================================================================
://
:// DONIGHT.BAT - Start the nightly process of checking that the SourceSafe
:// data makes properly.
://
:// This is the only way to capture the entire output of a batch file.  At
:// least without having to use a DOSKEY alias.
://
:// 
:// D:\PP_BUILD DIRECTORY *HAS* TO EXIST!  NIGHTRUN.BAT parameters follow these.
://
:// ============================================================================

@echo cmd-line check : %0 %1 %2 %3 %4 %5 %6 %7 %8 %9


:***************************** NIGHT BUILD SETUP *****************************

:// Initialize these variables before running the night build on your project
:// There should be no need to edit any other part of this batch file

:// Perforce executable directory
SET P4="c:\program files\perforce\p4.exe"

:// Perforce user that will be running night build
SET perforceUser=cchow

:// Perforce port of project database
SET perforcePort=RADFS4:1675

:// Name of project's root directory (this is the actual directory on the HDD)
SET projName=Depot

:// P4 Depot's root directory (this is the name in P4)
SET depotProjName=game

:// Location of root directory of project 
:// Example: for c:\projects\hockey, enter \projects\)
SET projParentDir=\
SET projDrive=D:

:// P4 Depot's project root
SET depotProjRoot=D:\

:// Root name of executable generated by code build process (i.e. no extension)
:// The existence of this file is checked to test for the success of the build
:// The letters 'd', 'o' or 'r' are appended for debug, optimized and release
:// executables.
:// The appropriate extension is also appended: exe for windows, elf for ps2.
SET GCName=srr2g
SET elfName=srr2p
SET xbeName=srr2x

:// Network directory to copy the builds to
:// Sub-directory names will be appended to this directory for each platform
:// and level of optimization
SET networkDir=T:\team\Simpsons2\Playable

SET localDir=D:\nightlybuilds\

:// People to send email to when build is done
:// 
:// 
SET mailRecipients= vceraldi@radical.ca jdeyoung@radical.ca cchow@radical.ca mng@radical.ca mmiller@radical.ca cdellinger@radical.ca

:// Maximum number of builds for each platform to keep on harddrive
:// The number of x's is the number of builds
:// maxDirs=xxxxx means that the max number of builds is 5.
:// nightrun.bat will delete the oldest build if there are 5 or more builds.
SET maxDirs=xxx

:************************* END NIGHT BUILD SETUP *****************************

:// Build some directory paths from the user-specified settings above

://SET projRootDir=%projParentDir%%projName%\
://SET nightBuildDir=%projRootDir%build\night\

:// hardcode the nightly build directory... all builds will be archived from here
:// i.e., d:\nightlybuilds
SET projRootDir=%projParentDir%nightlybuilds\
SET nightBuildDir=%projRootDir%

:// set this to where ever the tools\mksnt\ directory is on *your* machine
SET mksDir=D:\depot\game\build\tools\mksnt\

:// Include the time/date in the prompt
SET old_prompt=%PROMPT%
PROMPT $T - $P$G

:// Run the night build (nightrun should be in same directory as donight)
://
CALL NightRun.BAT %1 %2 %3 %4 %5 %6 %7 %8 %9  2>&1 | %mksDir%..\tee %projDrive%%nightBuildDir%results.txt

SET PROMPT=%old_prompt%
SET P4=
SET perforceUser=
SET perforcePort=
SET projName=
SET projParentDir=
SET projDrive=
SET exeName=
SET elfName=
SET xbeName=
SET networkDir=
SET localDir=
SET mailRecipients=
SET maxDirs=
SET projRootDir=
SET nightBuildDir=
SET mksDir=
SET old_prompt=

:// The nightly build doesn't close the DOS box properly and if it's left on
:// then the program sees the build as "still running" and doesn't
:// re-execute.  Need to change the properties of the nightly
:// build to shut down the previous build if it's time to run a new one.
